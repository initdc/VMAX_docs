<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>GLSL Support - V-Ray 2.0 for 3ds Max</title>

    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>


<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="917507">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">VRAY</span>
                    <img class="space-logo" src="spacelogo.png" />
                </h1>
                <a href="V-Ray_2.0_for_3ds_Max.html" class="ht-space-link">
                    <h2>V-Ray 2.0 for 3ds Max</h2>
                </a>
            </header>

            <nav class="ht-pages-nav">
                <ul class="ht-pages-nav-top">
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Getting_Started.html">Getting Started</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Licensing.html">Licensing</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="EULA.html">EULA</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="License_Server_Agreement.html">License Server Agreement</a>

            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Credits.html">Credits</a>

            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Migrating_from_V-Ray_1.5_to_V-Ray_2.0.html">Migrating from V-Ray 1.5 to V-Ray 2.0</a>

            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Features.html">Features</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Installation.html">Installation</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Installation_Troubleshooting.html">Installation Troubleshooting</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Silent_Install_and_Uninstall.html">Silent Install and Uninstall</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Uninstall_V-Ray.html">Uninstall V-Ray</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="V-Ray_Configuration.html">V-Ray Configuration</a>

            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Licensing_System.html">Licensing System</a>

            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting.html">Troubleshooting</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="V-Ray_and_3ds_Max.html">V-Ray and 3ds Max</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="MaxScript.html">MaxScript</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Texture_Baking.html">Texture Baking</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Unsupported_3ds_Max_Features.html">Unsupported 3ds Max Features</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Render_Elements.html">Render Elements</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="G-Buffer_Support.html">G-Buffer Support</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Hair_&amp;_Fur.html">Hair &amp; Fur</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="V-Ray_RT.html">V-Ray RT</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="V-Ray_RT_FAQ.html">V-Ray RT FAQ</a>

            </li>
                            </ul>
            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Plugins.html">Plugins</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Rendering.html">Rendering</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href=" V-Ray_Frame_Buffer.html">&nbsp;V-Ray Frame Buffer</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Global_Switches.html">Global Switches</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Image_Sampler_(Antialiasing).html">Image Sampler (Antialiasing)</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Indirect_Illumination_(GI).html">Indirect Illumination (GI)</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Brute_Force_GI.html">Brute Force GI</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Irradiance_Map.html">Irradiance Map</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Global_Photon_Map.html">Global Photon Map</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Light_Cache.html">Light Cache</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Caustics.html">Caustics</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Environment.html">Environment</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="DMC_Sampler.html">DMC Sampler</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Color_Mapping.html">Color Mapping</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Camera.html">Camera</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Default_Displacement.html">Default Displacement</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="System.html">System</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Presets.html">Presets</a>

            </li>
                            </ul>
            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Materials.html">Materials</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayMtl.html">VRayMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRay2SidedMtl.html">VRay2SidedMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayOverrideMtl.html">VRayOverrideMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayLightMtl.html">VRayLightMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayMtlWrapper.html">VRayMtlWrapper</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayFastSSS.html">VRayFastSSS</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayFastSSS2.html">VRayFastSSS2</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayBlendMtl.html">VRayBlendMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRaySimbiontMtl.html">VRaySimbiontMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayCarPaintMtl.html">VRayCarPaintMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayFlakesMtl.html">VRayFlakesMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayOSLMtl.html">VRayOSLMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayHairMtl.html">VRayHairMtl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayGLSLMtl.html">VRayGLSLMtl</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Textures.html">Textures</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRaySun_and_VRaySky.html">VRaySun and VRaySky</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayDirt.html">VRayDirt</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayColor.html">VRayColor</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayMap.html">VRayMap</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayHDRI.html">VRayHDRI</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayEdgesTex.html">VRayEdgesTex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayBmpFilter.html">VRayBmpFilter</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayCompTex.html">VRayCompTex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayDistanceTex.html">VRayDistanceTex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayGLSLTex.html">VRayGLSLTex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayOSLTex.html">VRayOSLTex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayMultiSubTex.html">VRayMultiSubTex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayPtex.html">VRayPtex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayHairInfoTex.html">VRayHairInfoTex</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayColor2Bump.html">VRayColor2Bump</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRaySky.html">VRaySky</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRaySoftBox.html">VRaySoftBox</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Lighting.html">Lighting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayLight.html">VRayLight</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRaySun.html">VRaySun</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayIES_light.html">VRayIES light</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayAmbientLight.html">VRayAmbientLight</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Geometry.html">Geometry</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayFur.html">VRayFur</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayProxy.html">VRayProxy</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayPlane.html">VRayPlane</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Miscellaneous_Plugins.html">Miscellaneous Plugins</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayShadow.html">VRayShadow</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayShadowMap.html">VRayShadowMap</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayDisplacementMod.html">VRayDisplacementMod</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayToon.html">VRayToon</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayEnvironmentFog.html">VRayEnvironmentFog</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayPhysicalCamera.html">VRayPhysicalCamera</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRaySphereFade.html">VRaySphereFade</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayStereoscopic.html">VRayStereoscopic</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayStereoRig.html">VRayStereoRig</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayLensEffects.html">VRayLensEffects</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayLightMeter.html">VRayLightMeter</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayExposureControl.html">VRayExposureControl</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayBPTracer.html">VRayBPTracer</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayOrnatrixMod.html">VRayOrnatrixMod</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VRayHairFarmMod.html">VRayHairFarmMod</a>

            </li>
                            </ul>
            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Object_and_Light_Properties.html">Object and Light Properties</a>

            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Distributed_Rendering.html">Distributed Rendering</a>

            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link current" href="GLSL_Support.html">GLSL Support</a>

            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="OSL_Support.html">OSL Support</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Tools.html">Tools</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Irradiance_Map_Viewer.html">Irradiance Map Viewer</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href=".obj_and_.ply_to_.vrmesh_Converter_.html">.obj and .ply to .vrmesh Converter*</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href=".vrimg_to_.exr_Converter.html">.vrimg to .exr Converter</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Image_to_Tiled_Multiresolution_OpenEXR_Converter.html">Image to Tiled Multiresolution OpenEXR Converter</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="V-Ray_Scene_Exporter.html">V-Ray Scene Exporter</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Lens_Analysis_Utility.html">Lens Analysis Utility</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Filter_Generator.html">Filter Generator</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Tutorials.html">Tutorials</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Irradiance_Map_Modes__Rendering_a_Static_Scene_from_Multiple_Views.html">Irradiance Map Modes: Rendering a Static Scene from Multiple Views</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Rendering_a_Walk-Through_Animation.html">Rendering a Walk-Through Animation</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Photon_Mapping.html">Photon Mapping</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Displacement_Mapping.html">Displacement Mapping</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Rendering_an_Interior_Scene.html">Rendering an Interior Scene</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Progressive_Path_Tracing_with_V-Ray.html">Progressive Path Tracing with V-Ray</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Rendering_Surface_Interfaces.html">Rendering Surface Interfaces</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Rendering_an_Animation_with_Moving_Objects.html">Rendering an Animation with Moving Objects</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Rendering_an_Animation_with_Moving_Objects_II.html">Rendering an Animation with Moving Objects II</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Basic_Texture_Baking_with_V-Ray,_Part_I.html">Basic Texture Baking with V-Ray, Part I</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Universal_V-Ray_Settings.html">Universal V-Ray Settings</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Rendering_PTex_Textures_from_Mudbox.html">Rendering PTex Textures from Mudbox</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Theory.html">Theory</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Raytracing_Overview.html">Raytracing Overview</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="GI_Methods.html">GI Methods</a>

            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Terminology.html">Terminology</a>

            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Frequently_Asked_Questions.html">Frequently Asked Questions</a>

            </li>
                                    </ul>
            </nav>
        </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="V-Ray_2.0_for_3ds_Max.html">V-Ray 2.0 for 3ds Max</a></li>
                                                            </ul>
</div>            <h1 id="src-2557514"> <span>GLSL Support</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <p  >    </p>
<ul class="toc-indentation "><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-GLSLsupportinV-RayOverview">GLSL support in V-Ray Overview</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-AdditionalPreprocessorDefines">Additional Preprocessor Defines</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-AdditionalTypeQualifiersAdditionalTypeQualifiers">Additional Type Qualifiers</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-Built-InVaryingVariables">Built-In Varying Variables</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-Built-InUniformVariables">Built-In Uniform Variables</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-BuiltInConstantsBuilt-InConstants">Built-In Constants</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-BuiltInTypesBuilt-InTypes">Built-In Types</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-BuiltInFunctionsBuilt-InFunctions">Built-In Functions</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-UnsupportedGLSLFeatures">Unsupported GLSL Features</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-ExamplesExamples">Examples</a>    </p>
<ul class="toc-indentation "><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpDb29sTWV0YWxsaWM">Example: Cool Metallic</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHZW5lcmF0b3JTdHJpcGU">Example: Generator Stripe</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHbG9zc3lHbGFzcw">Example: Glossy Glass</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHbG9zc3lQaG9uZw">Example: Glossy Phong</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHbG9zc3lSZWZsZWN0aW9u">Example: Glossy Reflection</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpPcmVuLU5heWFy">Example: Oren-Nayar</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpUdXJidWxlbmNl">Example: Turbulence</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpCbGlubk1hdGVyaWFs">Example: Blinn Material</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpUcmFuc3BhcmVudE1hdGVyaWFs">Example: Transparent Material</a>    </p>
</li><li class=" ">    <p  ><a   href="#src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpSZW5kZXJDaGFubmVscw">Example: Render Channels</a>    </p>
</li></ul></li><li class=" ">    <p  ><a   href="#src-2557514_GLSLSupport-Notes">Notes</a>    </p>
</li></ul>    <div class="section section-1" id="src-2557514_GLSLSupport-GLSLsupportinV-RayOverview">
        <h1 class="heading "><span>GLSL support in V-Ray Overview</span></h1>
    <p  >    <span style="color: #000000;">
The V-Ray extensions for GLSL (vrayGLSL for short) add several    </span>
     <span style="color: #000000;">
functions    </span>
    <span style="color: #000000;">
 and variables that can be used in GLSL shaders with the    </span>
 <a  class="unresolved" href="#src-2557514">VRayGLSLTex</a>     <span style="color: #000000;">
texture and the    </span>
 <a  class="unresolved" href="#src-2557514">VRayGLSLMtl</a>     <span style="color: #000000;">
material. See the    </span>
 <a   href="#src-2557514_GLSLSupport-Examples">Examples</a>     <span style="color: #000000;">
section below for some samples.    </span>
    </p>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-AdditionalPreprocessorDefines">
        <h1 class="heading "><span>Additional Preprocessor Defines </span></h1>
<pre class=" ">    <span style="color: #000000;">
__VRAY_GLSL__=110    </span>
</pre>    <p  >    <span style="color: #000000;">
The __VRAY_GLSL__ macro holds the version of the vrayGLSL. The following list summarizes the available language features in each vrayGLSL version:    </span>
    </p>
<ul class=" "><li class=" ">    <p  >    <span style="color: #000000;">
Not defined - The initial vrayGLSL version based on GLSL 1.10.59 plus additional support for:<br/>    </span>
    </p>
<ul class=" "><li class=" ">    <p  >32-bit int type.    </p>
</li><li class=" ">    <p  >bitwise operations.    </p>
</li><li class=" ">    <p  >uniform initializers.    </p>
</li></ul></li><li class=" ">    <p  >    <span style="color: #000000;">
100. Added support for:<br/>    </span>
    </p>
<ul class=" "><li class=" ">    <p  >    <span style="color: #666699;">
__channel    </span>
 and     <span style="color: #666699;">
__persistent    </span>
 keyword.    </p>
</li><li class=" ">    <p  >    <span style="color: #666699;">
__native    </span>
 keyword.    </p>
</li><li class=" ">    <p  >Fixed-size (GL_MAX_TEXTURE_COORDS=16)     <span style="color: #666699;">
gl_FragCoord[], vr_TextureDu[]    </span>
 and     <span style="color: #666699;">
vr_TextureDv[].    </span>
    </p>
</li></ul></li><li class=" ">    <p  >    <span style="color: #000000;">
110. Added support for:    </span>
    </p>
<ul class=" "><li class=" ">    <p  >    <span style="color: #666699;">
__color    </span>
 keyword.    </p>
</li></ul></li></ul><pre class=" ">    <span style="color: #000000;">
     </span>
</pre><pre class=" ">    <span style="color: #000000;">
__VRAY_HOST__=300    </span>
</pre>    <p  >    <span style="color: #000000;">
The __VRAY_HOST__ macro holds the version of V-Ray renderer.    </span>
    </p>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-AdditionalTypeQualifiersAdditionalTypeQualifiers">
        <h1 class="heading "><span>Additional Type Qualifiers </span></h1>
<pre class=" ">__channel</pre>    <p  >This type qualifier can be used only on global variables to mark them as render channels. Render channels would be automatically created and attached in the V-Ray VFB. There are several supported channel types: <strong class=" ">bool, int, float, vec2, </strong><strong class=" ">vec3</strong>. Writing to the render channel is done by assigning a value to the channel variable. Should there be more than a single write event to a channel variable the last written value is considered only. Set a default channel value by using an initializer.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">__channel vec2 UVSpace = vec2(</code><code class="value">0.314</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">  UVSpace = vec2(gl_TexCoord[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">  gl_FragColor = vec4(</code><code class="value">0.3</code><code class="plain">, </code><code class="value">0.8</code><code class="plain">, </code><code class="value">0.2</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <p  >    </p>
<pre class=" ">__persistent</pre>    <p  >    <span style="color: #000000;">
Use this type qualifier to make render    </span>
     <span style="color: #000000;">
channels    </span>
    <span style="color: #000000;">
 persistent. Persistent render channels would keep    </span>
    <span style="color: #000000;">
 their    </span>
    <span style="color: #000000;">
 value and write it to the V-Ray VFB even if the shader execution has reached a discard statement.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">__persistent __channel vec2 UVSpace = vec2(</code><code class="value">0.314</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">  UVSpace = vec2(gl_TexCoord[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">  discard;</code></div>
<div class="line"><code class="plain">  gl_FragColor = vec4(</code><code class="value">0.3</code><code class="plain">, </code><code class="value">0.8</code><code class="plain">, </code><code class="value">0.2</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <p  >    </p>
<pre class=" ">__native</pre>    <p  >    <span style="color: #000000;">
Use this type qualifier to mark functions and types as natively implemented in C (outside the GLSL shader code).    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">__native </code><code class="keyword">void</code><code class="plain"> notifyHost(vec2 problemLocation);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">  vec2 uv = vec2(gl_TexCoord[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">  </code><code class="keyword">if</code><code class="plain"> (dot(vr_Normal, -vr_Direction) &lt; </code><code class="value">0.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">    notifyHost(uv);</code></div>
<div class="line"><code class="plain">    discard;</code></div>
<div class="line"><code class="plain">  } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">    gl_FragColor = vec4(uv, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">  }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <p  >    </p>
    <p  >    <span style="color: #000000;">
NOTE: This feature is available only for V-Ray Standalone and V-Ray for Maya.    </span>
    </p>
    <p  >    <span style="color: #000000;">
<br/>    </span>
    </p>
<pre class=" ">__color</pre>    <p  >    <span style="color: #000000;">
Use this type qualifier to mark     <span style="color: #333399;">
vec3     <span style="color: #000000;">
or    </span>
 vec4    </span>
 types respectively as RGB or RGBA colors so that a color swatch is generated in the 3ds Max UI to tweak this parameters.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">__color uniform vec3 input_color = vec3(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.5</code><code class="plain">, </code><code class="value">0.25</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> alpha = </code><code class="value">1.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> gamma = </code><code class="value">1.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">  gl_FragColor = vec4(pow(input_color, vec3(</code><code class="value">1.0</code><code class="plain"> / gamma)), alpha);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-Built-InVaryingVariables">
        <h1 class="heading "><span>Built-In Varying Variables</span></h1>
    <p  >    <span style="color: #000000;">
varying vec4     <span style="color: #666699;">
gl_TexCoord[16];    </span>
 <br/>    </span>
    <span style="color: #000000;">
Texture coordinates. Fixed size array allows for a maximum of 16 texture coordinate channels.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_Position;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Intersection surface point in camera space coordinates.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_Normal;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Smooth surface normal unit vector at the surface intersection point in camera space.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_TexTangent;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Smooth surface tangent unit vector pointing along the texture u direction in camera space.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_TexBinormal;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Smooth surface binormal unit vector pointing along the texture v direction in camera space.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_Direction;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Unit vector pointing along the ray in camera space.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_Velocity;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Velocity of the surface point in camera space for one 3ds Max tick.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying int     <span style="color: #666699;">
vr_TotalRayDepth;    </span>
 <br/>    </span>
    <span style="color: #000000;">
The total depth of the ray being traced. It is the sum of all reflection, refraction and global illumination levels traced along the ray path so far.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying int     <span style="color: #666699;">
vr_DiffuseRayDepth;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Diffuse depth of the ray being traced. Only the number of global illumination levels traced along the ray path so far are considered.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying int     <span style="color: #666699;">
vr_NumSuperSamples;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Number of samples that the parent hit point along the ray path is taking.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying int     <span style="color: #666699;">
vr_SuperSampleIndex;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Index of the current supersample for this intersection point.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying int     <span style="color: #666699;">
vr_RayFlags;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Ray flags that describe the type of the current ray. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInConstants">Built-in constants</a>     <span style="color: #000000;">
for a list of supported flags.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_Origin;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Currently traced ray's origin in camera space coordinates.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_GeomNormal;    </span>
 <br/>    </span>
    <span style="color: #000000;">
The true geometric normal unit vector for the hit primitive in camera space coordinates.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_TextureDu[16];    </span>
 <br/>    </span>
    <span style="color: #000000;">
The array of surface derivatives with respect to the u direction of the specified texture space. All derivatives are unit vectors in camera space.    </span>
    </p>
    <p  >    <span style="color: #000000;">
varying vec3     <span style="color: #666699;">
vr_TextureDv[16];    </span>
 <br/>    </span>
    <span style="color: #000000;">
The array of surface derivatives with respect to the v direction of the specified texture space. All derivatives are unit vectors in camera space.    </span>
    </p>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-Built-InUniformVariables">
        <h1 class="heading "><span>Built-In Uniform Variables </span></h1>
    <p  >    <span style="color: #000000;">
uniform int     <span style="color: #666699;">
vr_NumLights;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Number of lights in the scene.    </span>
    </p>
    <p  >    <span style="color: #000000;">
uniform mat4     <span style="color: #666699;">
vr_CameraToWorld;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Camera-to-world space transformation matrix.    </span>
    </p>
    <p  >    <span style="color: #000000;">
uniform mat4     <span style="color: #666699;">
vr_WorldToCamera;    </span>
 <br/>    </span>
    <span style="color: #000000;">
World-to-camera space transformation matrix.    </span>
    </p>
    <p  >    <span style="color: #000000;">
uniform mat4     <span style="color: #666699;">
vr_CameraToObject;    </span>
     </span>
<br/>    <span style="color: #000000;">
Camera-to-object space transformation matrix.    </span>
    </p>
    <p  >    <span style="color: #000000;">
uniform mat4     <span style="color: #666699;">
vr_ObjectToCamera;    </span>
     </span>
<br/>    <span style="color: #000000;">
Object-to-camera space transformation matrix.    </span>
    </p>
    <p  >    <span style="color: #000000;">
uniform vr_FrameDataSettings     <span style="color: #666699;">
vr_FrameData;    </span>
 <br/>    </span>
    <span style="color: #000000;">
<span id="src-2557514_GLSLSupport-vr_FrameData"></span>Built-in    </span>
     <span style="color: #000000;">
instance    </span>
    <span style="color: #000000;">
 of the vr_FrameDataSettings structure which holds important per frame parameters. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>    <span style="color: #000000;">
 for all available members of the vr_FrameDataSettings type. It is best to hold a local copy of this instance instead of always referring to the original     <span style="color: #666699;">
vr_FrameData.    </span>
    </span>
<br/><br/>    <span style="color: #000000;">
NOTE: When using the transformation matrices, always place the vector to be transformed on the right-hand side.    </span>
    </p>
    <p  >    <span style="color: #000000;">
NOTE: Always wrap the     <span style="color: #666699;">
vec3    </span>
 vector to be transformed in     <span style="color: #666699;">
vec4    </span>
 variables where the w-coordinate is 0.0 for direction     <span style="color: #666699;">
vec3    </span>
 vectors and 1.0 for coordinate     <span style="color: #666699;">
vec3    </span>
 points.    </span>
    </p>
    <p  >    <span style="color: #000000;">
NOTE: vrayGLSL allows user-defined uniform variables to be initialized at global scope. This is a very handy technique to give your shaders default input values.    </span>
    </p>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-BuiltInConstantsBuilt-InConstants">
        <h1 class="heading "><span id="src-2557514_GLSLSupport-BuiltInConstants" class="confluence-anchor-link"></span><span>Built-In Constants </span></h1>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_TRACE_REFRACT;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Tells the     <span style="color: #666699;">
vr_trace()    </span>
 function to trace    </span>
     <span style="color: #000000;">
refractions.    </span>
    <span style="color: #000000;">
 Must be set in the rayType member of the     <span style="color: #666699;">
vr_TraceOptions.    </span>
 See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>    <span style="color: #000000;">
 for the definition of     <span style="color: #666699;">
vr_TraceOptions.    </span>
    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_TRACE_REFLECT;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Tells the     <span style="color: #666699;">
vr_trace()    </span>
 function to trace reflections. Must be set in the rayType member of the     <span style="color: #666699;">
vr_TraceOptions.    </span>
 See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for the definition of     <span style="color: #666699;">
vr_TraceOptions.    </span>
    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_TRACE_TRANSPARENT;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Tells the     <span style="color: #666699;">
vr_trace()    </span>
 function to trace further along the ray as if no surface had been hit. Must be set in the rayType member of the     <span style="color: #666699;">
vr_TraceOptions.    </span>
 See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for the definition of     <span style="color: #666699;">
vr_TraceOptions.    </span>
    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_TRACE_ENVIRONMENT;    </span>
     </span>
<br/>    <span style="color: #000000;">
Tells the     <span style="color: #666699;">
vr_trace()    </span>
 function to sample the scene environment using the    </span>
     <span style="color: #000000;">
current    </span>
    <span style="color: #000000;">
 ray direction regardless of what is in the ray's path. Must be set in the rayType member of the     <span style="color: #666699;">
vr_TraceOptions.    </span>
 See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for the definition of     <span style="color: #666699;">
vr_TraceOptions.    </span>
    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_REFLECT_FLAG;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Flag used to mark rays that have gone through at least one reflection.    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_REFRACT_FLAG;    </span>
     </span>
<br/>    <span style="color: #000000;">
Flag used to mark rays that have gone through at least one refraction.    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_SHADOW_FLAG;    </span>
     </span>
<br/>    <span style="color: #000000;">
Flag used to mark shadow rays.    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_INDIRECT_FLAG;    </span>
 <br/>    </span>
    <span style="color: #000000;">
Flag used to mark gathering global illumination rays.    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_GLOSSY_FLAG;    </span>
     </span>
<br/>    <span style="color: #000000;">
Flag used to mark rays that have gone through glossy reflection or refraction.    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_ENVIRONMENT_FLAG;    </span>
     </span>
<br/>    <span style="color: #000000;">
Flag used to mark rays shaded with environment contribution taken into account.    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_SPECULAR_DISPERSAL;    </span>
     </span>
<br/>    <span style="color: #000000;">
Flag used to notify the     <span style="color: #666699;">
vr_trace()    </span>
 function that we are tracing a single specular ray. Must be set in the rayGroup member of the     <span style="color: #666699;">
vr_TraceOptions.    </span>
 See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for the definition of     <span style="color: #666699;">
vr_TraceOptions.    </span>
    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_GLOSSY_DISPERSAL;    </span>
     </span>
<br/>    <span style="color: #000000;">
Flag used to notify the     <span style="color: #666699;">
vr_trace()    </span>
 function that we are tracing multiple glossy rays. Must be set in the rayGroup member of the     <span style="color: #666699;">
vr_TraceOptions.    </span>
 See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for the definition of     <span style="color: #666699;">
vr_TraceOptions.    </span>
    </span>
    </p>
    <p  >    <span style="color: #000000;">
const int     <span style="color: #666699;">
VR_DIFFUSE_DISPERSAL;    </span>
     </span>
<br/>    <span style="color: #000000;">
This constant is reserved for future use.    </span>
    </p>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-BuiltInTypesBuilt-InTypes">
        <h1 class="heading "><span id="src-2557514_GLSLSupport-BuiltInTypes" class="confluence-anchor-link"></span><span>Built-In Types </span></h1>
    <p  >    <span style="color: #000000;">
<span id="src-2557514_GLSLSupport-VRLightIterator"></span>The     <span style="color: #666699;">
vr_LightIterator    </span>
 structure holds important shade data for a particular light source in the scene. To obtain this information call    </span>
 <a   href="#src-2557514_GLSLSupport-VREvalLight">vr_evalLight</a>     <span style="color: #000000;">
with an instance of     <span style="color: #666699;">
vr_LightIterator    </span>
 as last argument. All members will be set with the required data for the selected light.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_LightIterator {</code></div>
<div class="line"><code class="plain">	vec3 direction; </code><code class="comments">// unit vector pointing towards the light source in camera coordinates.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> dot_nl; </code><code class="comments">// dot product of the surface normal (possibly bumped) and the light direction.</code></div>
<div class="line"><code class="plain">	vec3 contribution; </code><code class="comments">// the direct light contribution from this light including atmospheric effects and distance falloff.</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
NOTE: If the light has multiple sample points (i.e. it is an area light), then direction contains an average vector pointing towards the cloud of sample points on the light.    </span>
    </p>
    <p  >    <span style="color: #000000;">
The vr_FrameDataSettings structure packs together uniform variables that hold scene settings for the current frame. The information is easily accessible via the built-in uniform variable    </span>
 <a   href="#src-2557514_GLSLSupport-vr_FrameData">vr_FrameData</a>     <span style="color: #000000;">
- instance of vr_FrameDataSettings.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_FrameDataSettings {</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> frameIndex; </code><code class="comments">// Current frame index.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> frameTime; </code><code class="comments">// Time of the current frame in ticks.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> frameStart; </code><code class="comments">// Start of the frame in time. Usually frameStart &lt;= frameTime &lt;= frameEnd.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> frameEnd; </code><code class="comments">// End of the frame in time. Usually frameStart &lt;= frameTime &lt;= frameEnd.</code></div>
<div class="line"><code class="plain">	bool isOrthographic; </code><code class="comments">// True if camera rays are parallel.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> focalLength; </code><code class="comments">// The camera's focal length.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> aperture; </code><code class="comments">// The camera's aperture.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> aspectRatio; </code><code class="comments">// The pixel aspect ratio.</code></div>
<div class="line"><code class="plain">	vec2 imagePlaneOffset; </code><code class="comments">// The camera plane offset.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> dofRadius; </code><code class="comments">// The depth of field radius.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> dofFocus; </code><code class="comments">// The distance from the camera position to the focal plane.</code></div>
<div class="line"><code class="plain">	ivec2 imageResolution; </code><code class="comments">// Width and height of the entire output image in pixels ignoring the render region.</code></div>
<div class="line"><code class="plain">	ivec4 regionMargin; </code><code class="comments">// Render region margin in pixels.</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  ><i class=" ">Deprecated. Please use the     <span style="color: #666699;">
__color    </span>
 type qualifier instead. See <a   href="#src-2557514_GLSLSupport-AdditionalTypeQualifiers">Additional type qualifiers</a> for more information.</i>    </p>
    <p  ><del class=" ">    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_Color    </span>
 structure represents a rgba color. It is meant to replace the     <span style="color: #666699;">
vec4    </span>
 type in uniform variable declarations where     <span style="color: #666699;">
vec4    </span>
 is used as color.    </span>
</del>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_Color {</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> r; </code><code class="comments">// Red color component.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> g; </code><code class="comments">// Green color component.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> b; </code><code class="comments">// Blue color component.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> a; </code><code class="comments">// Alpha color component.</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  ><del class=" ">NOTE: This structure is only to be used for uniform variable declarations and uniform initializers at global scope. It is used instead of a     <span style="color: #666699;">
vec4    </span>
 when declaring a shader input parameter that is a rgba color.<del class=" ">    <span style="color: #000000;">
That way the UI will display a convenient color swatch instead of the controls displayed for a     <span style="color: #666699;">
vec4    </span>
 input parameter.    </span>
</del></del>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">uniform vr_Color diffuse_color = vr_Color(</code><code class="value">0.9</code><code class="plain">, </code><code class="value">0.2</code><code class="plain">, </code><code class="value">0.8</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_DiffuseBRDFSettings    </span>
 structure holds parameters of a diffuse BRDF. It configures the diffuse BRDF to be attached via the     <span style="color: #666699;">
vr_brdf_diffuse    </span>
 built-in function. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInFunctions">Built-in functions</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_DiffuseBRDFSettings {</code></div>
<div class="line"><code class="plain">	vec3 color; </code><code class="comments">// The diffuse color for the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	vec3 normal; </code><code class="comments">// The normal for which to calculate the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> roughness; </code><code class="comments">// Diffuse deviation in the [0.0, 1.0] range. Default value is 0.0.</code></div>
<div class="line"><code class="plain">	vec3 transparency; </code><code class="comments">// The transparency of the BRDF. Default value is vec3(0.0, 0.0, 0.0).</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_GlossyBRDFSettings    </span>
 structure holds parameters of a class of glossy BRDFs, namely the Phong, Blinn and Ward BRDFs. It configures the BRDF to be attached via the     <span style="color: #666699;">
vr_brdf_phong, vr_brdf_blinn    </span>
 or     <span style="color: #666699;">
vr_brdf_ward    </span>
 built-in functions. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInFunctions">Built-in functions</a>    <span style="color: #000000;">
 for more information.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_GlossyBRDFSettings {</code></div>
<div class="line"><code class="plain">	vec3 color; </code><code class="comments">// The specular(reflection) color for the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	vec3 normal; </code><code class="comments">// The normal for which to calculate the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> highlightGlossiness; </code><code class="comments">// Highlight glossiness of the BRDF in the [0.0, 1.0] range. Default value is 0.7.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> reflectionGlossiness; </code><code class="comments">// Reflection glossiness of the BRDF in the [0.0, 1.0] range. Default value is 0.7.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> subdivs; </code><code class="comments">// Amount of samples for the glossy reflection. Default value is 8.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> anisotropy; </code><code class="comments">// Anisotropy of the BRDF in the (-1.0, 1.0) range. Default value is 0.0.</code></div>
<div class="line"><code class="plain">	bool traceReflections; </code><code class="comments">// Set if the BRDF should trace reflections. Default value is true.</code></div>
<div class="line"><code class="plain">	vec3 transparency; </code><code class="comments">// The transparency of the BRDF. Default value is vec3(0.0, 0.0, 0.0).</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> softenEdge; </code><code class="comments">// Amount of softening the transition from dark to bright areas in specular reflections in the [-1.0, 1.0] range. Default value is 0.001.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> anisoRotation; </code><code class="comments">// Rotation of the BRDF anisotropy in degrees. Default value is 0.0.</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_MirrorBRDFSettings    </span>
 structure holds parameters of a mirror BRDF. It configures the mirror BRDF to be attached via the     <span style="color: #666699;">
vr_brdf_mirror    </span>
 built-in function. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInFunctions">Built-in functions</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_MirrorBRDFSettings {</code></div>
<div class="line"><code class="plain">	vec3 color; </code><code class="comments">// Filter color of the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	vec3 normal; </code><code class="comments">// The normal for which to calculate the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	vec3 transparency; </code><code class="comments">// The transparency of the BRDF. Default value is vec3(0.0, 0.0, 0.0).</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_GlassBRDFSettings    </span>
 structure holds parameters of a glass BRDF. It configures the glass BRDF to be attached via the     <span style="color: #666699;">
vr_brdf_glass    </span>
 built-in function.    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInFunctions">See Built-in functions</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_GlassBRDFSettings {</code></div>
<div class="line"><code class="plain">	vec3 color; </code><code class="comments">// Filter color of the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	vec3 normal; </code><code class="comments">// The normal for which to calculate the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> glossiness; </code><code class="comments">// Glossiness of the BRDF in the [0.0, 1.0] range. Default value is 0.7.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> ior; </code><code class="comments">// Surface index of refraction for the BRDF. Default value is 1.5.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> subdivs; </code><code class="comments">// Amount of samples for the glossy reflections/refraction. Default value is 8.</code></div>
<div class="line"><code class="plain">	vec3 transparency; </code><code class="comments">// The transparency of the BRDF. Default value is vec3(0.0, 0.0, 0.0).</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_LightBRDFSettings    </span>
 structure holds parameters of a V-Ray light BRDF. It configures the light BRDF to be attached via the     <span style="color: #666699;">
vr_brdf_light    </span>
 built-in function. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInFunctions">Built-in functions</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_LightBRDFSettings {</code></div>
<div class="line"><code class="plain">	vec3 color; </code><code class="comments">// Light color of the BRDF. Default value is vec3(1.0, 1.0, 1.0).</code></div>
<div class="line"><code class="plain">	vec3 transparency; </code><code class="comments">// The transparency of the BRDF. Default value is vec3(0.0, 0.0, 0.0).</code></div>
<div class="line"><code class="plain">	bool doubleSided; </code><code class="comments">// Makes the BRDF double sided. Default value is false.</code></div>
<div class="line"><code class="plain">	bool emitOnBackSide; </code><code class="comments">// Makes the BRDF emit light from its back side as well. If this is off, the material is rendered as black on the back sides. Default value is true.</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_TraceOptions    </span>
 structure holds all settings required for a ray trace. To carry out a successful trace, a well configured instance must be passed as a parameter to the    </span>
 <a   href="#src-2557514_GLSLSupport-VRTrace">vr_trace </a>    <span style="color: #000000;">
function. See the     <span style="color: #666699;">
vr_trace    </span>
 built-in function for more information.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_TraceOptions {</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> rayType; </code><code class="comments">// One of the built-in constants VR_TRACE_REFLECT, VR_TRACE_REFRACT, VR_TRACE_TRANSPARENT or VR_TRACE_ENVIRONMENT. See Built-in constants. Default values is VR_TRACE_REFLECT.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> rayGroup; </code><code class="comments">// One of the VR_SPECULAR_DISPERSAL or VR_GLOSSY_DISPERSAL built-in constants. See Built-in constants. Default value is VR_SPECULAR_DISPERSAL.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> ior; </code><code class="comments">// Surface index of refraction at the current hit point. Ignored unless tracing a refracted ray. Default value is 1.44.</code></div>
<div class="line"><code class="plain">	vec3 ray; </code><code class="comments">// User specified ray to be traced. Must be a unit vector in camera space. Default value is vec3(0.0, 0.0, 0.0).</code></div>
<div class="line"><code class="plain">	vec3 normal; </code><code class="comments">// The surface normal (possibly bumped) according to which the reflections/refraction will be calculated. Must be a unit vector in camera space. Default value is vec3(0.0, 0.0, 0.0).</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
The     <span style="color: #666699;">
vr_OcclusionOptions    </span>
 structure holds settings for the    </span>
 <a   href="#src-2557514_GLSLSupport-VROcclusion">vr_occlusion</a>     <span style="color: #000000;">
built-in function. It could be used to fine tune the occlusion sampling process. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInFunctions">Built-in functions</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">struct vr_OcclusionOptions {</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> radius; </code><code class="comments">// This parameters determines the amount of area (in units) where the ambient occlusion is calculated. Default value is 10.0.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> distribution; </code><code class="comments">// This parameter will force the sampling rays to gather closer to the surface normal. For evenly distributed samples use 0.0. For maximum surface normal concentrated sampling use 1.0. Allowed value range is [0.0, 1.0]. Default value is 0.0.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> falloff; </code><code class="comments">// This parameter controls the speed of the transition between occluded and unoccluded areas. Default value is 0.0.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> subdivs; </code><code class="comments">// This parameter holds the number of samples that V-Ray takes to calculate the occlusion effect. Lower values render faster but produce a more noisy result. Default value is 8.</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <p  >    <span style="color: #000000;">
NOTE: When creating an instance of type     </span>
    <span style="color: #666699;">
vr_DiffuseBRDFSettings, vr_GlossyBRDFSettings,    </span>
    <span style="color: #000000;">
     </span>
    <span style="color: #666699;">
vr_MirrorBRDFSettings, vr_GlassBRDFSettings,    </span>
    <span style="color: #000000;">
     </span>
    <span style="color: #666699;">
vr_LightBRDFSettings, vr_TraceOptions,    </span>
    <span style="color: #000000;">
 or     </span>
    <span style="color: #666699;">
vr_OcclusionOptions    </span>
    <span style="color: #000000;">
 all members are initialized to the given values above.    </span>
    </p>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-BuiltInFunctionsBuilt-InFunctions">
        <h1 class="heading "><span id="src-2557514_GLSLSupport-BuiltInFunctions" class="confluence-anchor-link"></span><span>Built-In Functions</span></h1>
    <p  ><span id="src-2557514_GLSLSupport-VREvalLight"></span>    <span style="color: #000000;">
void     <span style="color: #666699;">
vr_evalLight    </span>
(int lightIndex, vec3 position, vec3 normal, out vr_LightIterator light);<br/>    </span>
    <span style="color: #000000;">
Evaluates direct light contribution from an indexed light source. Use this function to evaluate direct light illumination of your shader.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
lightIndex    </span>
 - index of the light source in the scene; must be in the range [0,     <span style="color: #666699;">
vr_NumLights    <span style="color: #333333;">
)    </span>
.     </span>
<br/>    </span>
    <span style="color: #000000;">
    <span style="color: #666699;">
position    </span>
 - surface hit point coordinates in camera space. <br/>    </span>
    <span style="color: #000000;">
    <span style="color: #666699;">
normal    </span>
 - surface normal in camera space; expected to be a unit vector. <br/>    </span>
    <span style="color: #000000;">
    <span style="color: #666699;">
lightIterator    </span>
 - holds the result of the light sampling; see    </span>
 <a   href="#src-2557514_GLSLSupport-VRLightIterator">vr_LightIterator</a>.    </p>
    <p  >    <span style="color: #000000;">
<i class=" ">Deprecated. Please use the new</i>     <span style="color: #666699;">
    </span>
<a   href="#src-2557514_GLSLSupport-VRTrace">    <span style="color: #666699;">
vr_trace    </span>
(vr_TraceOptions)</a> <i class=" ">overload instead.<br/></i><del class=" ">vec4     <span style="color: #666699;">
vr_trace(int    </span>
 traceOptions, vec3 normal [, float materialIOR = 1.44]);</del><br/>    </span>
<del class=" ">    <span style="color: #000000;">
Traces the next ray depending on the traceOptions set following the light path. Use this function to trace different rays originating from the current surface hit point and get their color result.    </span>
</del>    </p>
    <p  ><del class=" ">    <span style="color: #000000;">
    <span style="color: #666699;">
traceOptions    </span>
 - one of the     <span style="color: #666699;">
VR_TRACE_REFLECT, VR_TRACE_REFRACT,    </span>
     <span style="color: #666699;">
VR_TRACE_TRANSPARENT, VR_TRACE_ENVIRONMENT    </span>
 constants.    </span>
</del><br/><del class=" ">    <span style="color: #000000;">
    <span style="color: #666699;">
normal    </span>
 - surface normal (possibly bumped) unit vector in camera space.    </span>
</del><br/><del class=" ">    <span style="color: #000000;">
    <span style="color: #666699;">
materialIOR    </span>
 - surface index of refraction for the current hit point. Optional parameter.    </span>
</del><br/><del class=" ">    <span style="color: #000000;">
return value - color as a result of tracing the specified ray type from the current surface hit point.    </span>
</del>    </p>
    <p  ><del class=" ">    <span style="color: #000000;">
NOTE: When the maximum ray depth limit is hit, the     <span style="color: #666699;">
vr_trace    </span>
 function returns black.    </span>
</del>    </p>
    <p  ><del class=" ">    <span style="color: #000000;">
NOTE: If the reflected by the bumped normal ray is beneath the hit surface it is replaced by a another one calculated using the geometric (not smoothed) normal. This may bring up artifacts (e.g. in your glossy reflection effects), so weight samples strictly, or limit the normal bumping factor.    </span>
</del>    </p>
    <p  ><del class=" ">    <span style="color: #000000;">
NOTE: materialIOR is taken into account only if     <span style="color: #666699;">
VM_TRACE_REFRACT    </span>
 is specified. If     <span style="color: #666699;">
vr_trace    </span>
 is called with the     <span style="color: #666699;">
VR_TRACE_REFRACT    </span>
 and materialIOR is not specified it will use material IOR of 1.44.    </span>
</del>    </p>
    <p  >    <span style="color: #000000;">
<span id="src-2557514_GLSLSupport-VRTrace"></span>vec4     <span style="color: #666699;">
vr_trace    </span>
(vr_TraceOptions traceOptions);    </span>
<br/>    <span style="color: #000000;">
Traces the next ray depending on the traceOptions parameter following the light path. Use this function to trace different rays originating from the current surface hit point and get their color result. This function has two modes. If the traceOptions.ray member is set to a non null vector it will be traced. Else V-Ray calculates the ray to be traced depending on traceOptions.normal. In both cases traceOptions.rayType and traceOptions.rayGroup must be set.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
traceOptions    </span>
 - properly set instance of     <span style="color: #666699;">
vr_TraceOptions    </span>
 according to the above description. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for more information.    </span>
<br/>    <span style="color: #000000;">
return value - color as a result of tracing the specified ray type from the current surface hit point.    </span>
    </p>
    <p  >    <span style="color: #000000;">
NOTE: When the maximum ray depth limit is hit, the     <span style="color: #666699;">
vr_trace    </span>
 function returns black.    </span>
    </p>
    <p  >    <span style="color: #000000;">
NOTE: If the reflected by the bumped normal ray is beneath the hit surface it is replaced by a another one calculated using the geometric (not smoothed) normal. This may bring up artifacts (e.g. in your glossy reflection effects), so weight samples strictly, or limit the normal bumping factor.    </span>
    </p>
    <p  >    <span style="color: #000000;">
NOTE: traceOptions.ior is taken into account only if traceOptions.rayType is specified as     <span style="color: #666699;">
VR_TRACE_REFRACT.    </span>
 If we are tracing a refraction and no ior value is set V-Ray will use the default.    </span>
    </p>
    <p  >    <span style="color: #000000;">
vec3     <span style="color: #666699;">
vr_irradiance    </span>
(vec3 normal, float importance);    </span>
<br/>    <span style="color: #000000;">
Use this function to acquire global illumination at the intersection point.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
normal    </span>
 - surface normal (possibly bumped) unit vector in camera space. <br/>    </span>
    <span style="color: #000000;">
    <span style="color: #666699;">
importance    </span>
 - used to control the precision of the global illumination calculation. Should be in the range [0,1].<br/>    </span>
    <span style="color: #000000;">
return value - rgb color as a result of the GI evaluation. No normalization factors are required.    </span>
    </p>
    <p  >    <span style="color: #000000;">
vec3     <span style="color: #666699;">
vr_randomSample    </span>
(int sampleIndex, int totalSamples)    </span>
<br/>    <span style="color: #000000;">
Retrieves a vector with random component values in the [0,1) range suitable for DMC sampling.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
sampleIndex    </span>
 - index of current sample. Must be in the range [0,     <span style="color: #666699;">
totalSamples    </span>
).    </span>
<br/>    <span style="color: #000000;">
    <span style="color: #666699;">
totalSamples    </span>
 - the total number of samples we would take from this hit point.    </span>
<br/>    <span style="color: #000000;">
return value - a     <span style="color: #666699;">
vec3    </span>
 vector with random component values in the [0,1) range suitable for DMC sampling.    </span>
    </p>
    <p  >    <span style="color: #000000;">
void    <span style="color: #666699;">
 vr_brdf_diffuse    </span>
(vr_DiffuseBRDFSettings brdfSettings);    </span>
<br/>    <span style="color: #000000;">
Use this function to assign a diffuse BRDF to the shader that will be automatically used for light evaluation (both direct and indirect). The new BRDF will be layered above other previously attached BRDFs but all result will be summed equally. No light loops or     <span style="color: #666699;">
vr_irradiance    </span>
 calls are required. A write to     <span style="color: #666699;">
gl_FragColor    </span>
 is necessary only to determine the alpha component of the result. The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 will be ignored.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
brdfSettings    </span>
 - holds the diffuse BRDF settings. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <p  >    <span style="color: #000000;">
void     <span style="color: #666699;">
vr_brdf_phong    </span>
(vr_GlossyBRDFSettings brdfSettings);    </span>
<br/>    <span style="color: #000000;">
Use this function to assign a Phong BRDF to the shader that will be automatically used for light evaluation (both direct and indirect). The new BRDF will be layered above other previously attached BRDFs but all result will be summed equally. No light loops or     <span style="color: #666699;">
vr_irradiance    </span>
 calls are required. A write to     <span style="color: #666699;">
gl_FragColor    </span>
 is necessary only to determine the alpha component of the result. The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 will be ignored.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
brdfSettings    </span>
 - holds the Phong BRDF settings. All anisotropy members are ignored. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>    <span style="color: #000000;">
 for more information.    </span>
    </p>
    <p  >    <span style="color: #000000;">
void     <span style="color: #666699;">
vr_brdf_blinn    </span>
(vr_GlossyBRDFSettings brdfSettings);    </span>
<br/>    <span style="color: #000000;">
Use this function to assign a Blinn BRDF to the shader that will be automatically used for light evaluation (both direct and indirect). The new BRDF will be layered above other previously attached BRDFs but all result will be summed equally. No light loops or     <span style="color: #666699;">
vr_irradiance    </span>
 calls are required. A write to     <span style="color: #666699;">
gl_FragColor    </span>
 is necessary only to determine the alpha component of the result. The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 will be ignored.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
brdfSettings    </span>
 - holds the Blinn BRDF settings. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>    <span style="color: #000000;">
 for more information.    </span>
    </p>
    <p  >    <span style="color: #000000;">
void     <span style="color: #666699;">
vr_brdf_ward    </span>
(vr_GlossyBRDFSettings brdfSettings);    </span>
<br/>    <span style="color: #000000;">
Use this function to assign a Ward BRDF to the shader that will be automatically used for light evaluation (both direct and indirect). The new BRDF will be layered above other previously attached BRDFs but all result will be summed equally. No light loops or     <span style="color: #666699;">
vr_irradiance    </span>
 calls are required. A write to     <span style="color: #666699;">
gl_FragColor    </span>
 is necessary only to determine the alpha component of the result. The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 will be ignored.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
brdfSettings    </span>
 - holds the Ward BRDF settings. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>    <span style="color: #000000;">
 for more information.    </span>
    </p>
    <p  >    <span style="color: #000000;">
void     <span style="color: #666699;">
vr_brdf_glass    </span>
(vr_GlassBRDFSettings brdfSettings);    </span>
<br/>    <span style="color: #000000;">
Use this function to assign a Glass BRDF to the shader that will be automatically used for light evaluation (both direct and indirect). The new BRDF will be layered above other previously attached BRDFs but all result will be summed equally. No light loops or     <span style="color: #666699;">
vr_irradiance    </span>
 calls are required. A write to     <span style="color: #666699;">
gl_FragColor    </span>
 is necessary only to determine the alpha component of the result. The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 will be ignored.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
brdfSettings    </span>
 - holds the Glass BRDF settings. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <p  >    <span style="color: #000000;">
void     <span style="color: #666699;">
vr_brdf_mirror    </span>
(vr_MirrorBRDFSettings brdfSettings);    </span>
<br/>    <span style="color: #000000;">
Use this function to assign a Mirror BRDF to the shader that will be automatically used for light evaluation (both direct and indirect). The new BRDF will be layered above other previously attached BRDFs but all result will be summed equally. No light loops or     <span style="color: #666699;">
vr_irradiance    </span>
 calls are required. A write to     <span style="color: #666699;">
gl_FragColor    </span>
 is necessary only to determine the alpha component of the result. The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 will be ignored.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
brdfSettings    </span>
 - holds the Mirror BRDF settings. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>    <span style="color: #000000;">
 for more information.    </span>
    </p>
    <p  >    <span style="color: #000000;">
void     <span style="color: #666699;">
vr_brdf_light    </span>
(vr_LightBRDFSettings brdfSettings);    </span>
<br/>    <span style="color: #000000;">
Use this function to assign a Light BRDF to the shader that will be automatically used for light evaluation (both direct and indirect). The new BRDF will be layered above other previously attached BRDFs but all result will be summed equally. No light loops or     <span style="color: #666699;">
vr_irradiance    </span>
 calls are required. A write to     <span style="color: #666699;">
gl_FragColor    </span>
 is necessary only to determine the alpha component of the result. The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 will be ignored.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
brdfSettings    </span>
 - holds the Light BRDF settings. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>     <span style="color: #000000;">
for more information.    </span>
    </p>
    <p  >    <span style="color: #000000;">
vec3    <span style="color: #666699;">
 vr_textureSize    </span>
(sampler1D sampler);    </span>
<br/>    <span style="color: #000000;">
Use this function to get the size of the attached texture in pixels.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
sampler    </span>
 - sampler to which the texture is attached.    </span>
<br/>    <span style="color: #000000;">
return value -     <span style="color: #666699;">
vec3    </span>
 holding the width of the attached texure to the sampler in its x component or 0.0 if there is no texture attached. All other components will be 0.0.    </span>
    </p>
    <p  >    <span style="color: #000000;">
vec3     <span style="color: #666699;">
vr_textureSize    </span>
(sampler2D sampler);    </span>
<br/>    <span style="color: #000000;">
Use this function to get the size of the attached texture in pixels.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
sampler    </span>
 - sampler to which the texture is attached.    </span>
<br/>    <span style="color: #000000;">
return value -     <span style="color: #666699;">
vec3    </span>
 holding the width and height of the attached texure to the sampler in its x and y components or 0.0 if there is no texture attached. The z component will be 0.0.    </span>
    </p>
    <p  >    <span style="color: #000000;">
<span id="src-2557514_GLSLSupport-VROcclusion"></span>float     <span style="color: #666699;">
vr_occlusion    </span>
(vr_OcclusionOptions options);    </span>
<br/>    <span style="color: #000000;">
Use this function to evaluate the amount of ambient occlusion at the current surface hit point.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
options    </span>
 - configuration parameters for the sampling process. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInTypes">Built-in types</a>    <span style="color: #000000;">
 for more information.    </span>
<br/>    <span style="color: #000000;">
return value - a float value in the [0.0, 1.0] range. A return value of 0.0 means no surface ambient occlusion, while 1.0 is interpreted as fully occluded surface point.    </span>
    </p>
    <p  >    <span style="color: #000000;">
vec4     <span style="color: #666699;">
textureCube    </span>
(samplerCube sampler, vec3 sampleDir);    </span>
<br/>    <span style="color: #000000;">
Use this function to do cubemap texture sampling.    </span>
    </p>
    <p  >    <span style="color: #000000;">
    <span style="color: #666699;">
sampler    </span>
 - sampler to which the cubemap texture is attached. The texture must follow the horizontal cross configuration with +Y pointing up.     </span>
<br/>    <span style="color: #000000;">
    <span style="color: #666699;">
sampleDir    </span>
 - sampling direction. Expected to be a normalized unit vector in camera space.    </span>
<br/>    <span style="color: #000000;">
return value - color corresponding to the sampling direction.    </span>
    </p>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-UnsupportedGLSLFeatures">
        <h1 class="heading "><span>Unsupported GLSL Features </span></h1>
    <p  >    <span style="color: #000000;">
The following GLSL features are not supported by the V-Ray GLSL implementation.    </span>
    <span style="color: #000000;">
    </span>
    </p>
    <p  >    <span style="color: #000000;">
Built-in varying variables:    </span>
    </p>
<ul class=" "><li class=" ">    <p  >    <span style="color: #000000;">
Reading values from float     </span>
    <span style="color: #666699;">
gl_FogFragCoord    </span>
    <span style="color: #000000;">
 is not supported. It always returns     </span>
    <span style="color: #000000;">
0.0    </span>
    <span style="color: #000000;">
.    </span>
    </p>
</li><li class=" ">    <p  >    <span style="color: #000000;">
vec4     <span style="color: #666699;">
gl_Color    </span>
 returns white for front facing primitives and black otherwise.    </span>
    </p>
</li><li class=" ">    <p  >    <span style="color: #000000;">
vec4     <span style="color: #666699;">
gl_SecondaryColor    </span>
 returns white for front facing primitives and black otherwise.    </span>
    </p>
</li></ul>    <p  >    <span style="color: #000000;">
Built-in uniform variables:    </span>
    </p>
<ul class=" "><li class=" ">    <p  >    <span style="color: #000000;">
The following transformation matrices are accessible in fragment shaders but have only default     <span style="color: #666699;">
values:    </span>
    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewMatrix    </span>
<br/>    <span style="color: #666699;">
gl_ProjectionMatrix    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewProjectionMatrix    </span>
<br/>    <span style="color: #666699;">
gl_NormalMatrix    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewMatrixInverse    </span>
<br/>    <span style="color: #666699;">
gl_ProjectionMatrixInverse    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewProjectionMatrixInverse    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewMatrixTranspose    </span>
<br/>    <span style="color: #666699;">
gl_ProjectionMatrixTranspose    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewProjectionMatrixTranspose    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewMatrixInverseTranspose    </span>
<br/>    <span style="color: #666699;">
gl_ProjectionMatrixInverseTranspose    </span>
<br/>    <span style="color: #666699;">
gl_ModelViewProjectionMatrixInverseTranspose    </span>
<br/>    <span style="color: #666699;">
gl_TextureMatrix    </span>
<br/>    <span style="color: #666699;">
gl_TextureMatrixInverse    </span>
<br/>    <span style="color: #666699;">
gl_TextureMatrixTranspose    </span>
<br/>    <span style="color: #000000;">
    <span style="color: #666699;">
gl_TextureMatrixInverseTranspose    </span>
 <br/><br/>Instead, coordinate space transformations in fragment shaders are done via     <span style="color: #666699;">
vr_CameraToWorld, vr_WorldToCamera,    </span>
     <span style="color: #666699;">
vr_CameraToObject,    </span>
     <span style="color: #666699;">
vr_ObjectToCamera.    </span>
 For texture space transformations, the following code may be used:    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">vec3 tangent = vr_TexTangent;</code></div>
<div class="line"><code class="plain">vec3 binormal = vr_TexBinormal;</code></div>
<div class="line"><code class="plain">vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">mat3 vr_TextureToCamera = mat3(tangent, binormal, normal);</code></div>
</div>
    </div>
</li></ul><ul class=" "><li class=" ">    <p  >    <span style="color: #000000;">
The following uniform variables return black/zero/default values and are therefore not     <span style="color: #666699;">
supported:    </span>
    </span>
<br/>    <span style="color: #666699;">
gl_NormalScale    </span>
<br/>    <span style="color: #666699;">
gl_Point    </span>
<br/>    <span style="color: #666699;">
gl_FrontMaterial    </span>
<br/>    <span style="color: #666699;">
gl_BackMaterial    </span>
<br/>    <span style="color: #666699;">
gl_LightSource    </span>
<br/>    <span style="color: #666699;">
gl_LightModel    </span>
<br/>    <span style="color: #666699;">
gl_FrontLightModelProduct    </span>
<br/>    <span style="color: #666699;">
gl_BackLightModelProduct    </span>
<br/>    <span style="color: #666699;">
gl_FrontLightProduct    </span>
<br/>    <span style="color: #666699;">
gl_BackLightProduct    </span>
<br/>    <span style="color: #666699;">
gl_TextureEnvColor    </span>
<br/>    <span style="color: #666699;">
gl_EyePlaneS    </span>
<br/>    <span style="color: #666699;">
gl_EyePlaneT    </span>
<br/>    <span style="color: #666699;">
gl_EyePlaneR    </span>
<br/>    <span style="color: #666699;">
gl_EyePlaneQ    </span>
<br/>    <span style="color: #666699;">
gl_ObjectPlaneS    </span>
<br/>    <span style="color: #666699;">
gl_ObjectPlaneT    </span>
<br/>    <span style="color: #666699;">
gl_ObjectPlaneR    </span>
<br/>    <span style="color: #666699;">
gl_ObjectPlaneQ    </span>
<br/>    <span style="color: #000000;">
    <span style="color: #666699;">
gl_Fog    </span>
    </span>
    </p>
</li></ul>    <p  >    <span style="color: #000000;">
Special output variables:    </span>
    </p>
<ul class=" "><li class=" ">    <p  >    <span style="color: #000000;">
Writing to     <span style="color: #666699;">
gl_FragDepth    </span>
 is not supported. No changes occur.    </span>
    </p>
</li><li class=" ">    <p  >    <span style="color: #000000;">
Writing to     <span style="color: #666699;">
gl_FragData    </span>
 is not supported. Writing to     <span style="color: #666699;">
gl_FragColor    </span>
 or discarding the fragment is mandatory and thus cancels out     <span style="color: #666699;">
gl_FragData.    </span>
 The rgb components of     <span style="color: #666699;">
gl_FragColor    </span>
 are ignored in case a BRDF has been attached to the shader via the vr_brdf built-in functions. See    </span>
 <a   href="#src-2557514_GLSLSupport-BuiltInFunctions">Built-in functions</a><a  class="external-link" href="http://help.chaosgroup.com/vray/help/300R1/vrayglsl.htm#functions"> for more information.</a>    </p>
</li></ul>    <p  >    <span style="color: #000000;">
Built-in functions:    </span>
    </p>
<ul class=" "><li class=" ">    <p  >    <span style="color: #000000;">
The texture sampling function     <span style="color: #666699;">
texture3D    </span>
 is not supported.    </span>
    </p>
</li><li class=" ">    <p  >    <span style="color: #000000;">
All shadow functions are not supported. V-Ray takes care of shadowing.    </span>
    </p>
</li><li class=" ">    <p  >    <span style="color: #000000;">
All &quot;Proj&quot; and/or &quot;Lod&quot; versions of the texture sampling functions. The optional bias parameter is ignored. V-Ray takes care of texture filtering and level of detail during sampling.    </span>
    </p>
</li></ul>    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-ExamplesExamples">
        <h1 class="heading "><span id="src-2557514_GLSLSupport-Examples" class="confluence-anchor-link"></span><span>Examples</span></h1>
    <p  >    </p>
    <p  >    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpDb29sTWV0YWxsaWM" class="heading "><span>Example: Cool Metallic</span></h4>
    <p  >    <span style="color: #333399;">
This example generates a metallic-looking material.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/cool_metallic.png" alt="images/download/attachments/2557514/cool_metallic.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/cool_metallic_ui.png" alt="images/download/attachments/2557514/cool_metallic_ui.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: cool_metallic.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">__color uniform vec4 front_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">__color uniform vec4 background_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> amount = </code><code class="value">0.8</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> diffuse_scalar = </code><code class="value">0.7</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_scalar = </code><code class="value">0.06</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_shininess = </code><code class="value">200.0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">float</code><code class="plain"> phong_specular(vec3 light_dir, vec3 view_dir, vec3 normal, </code><code class="keyword">float</code><code class="plain"> specular_shininess) {</code></div>
<div class="line"><code class="plain">	vec3 reflection = reflect(view_dir, normal);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cos_rl = clamp(dot(reflection, light_dir), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">return</code><code class="plain"> (pow(cos_rl, specular_shininess) * (specular_shininess + </code><code class="value">2.0</code><code class="plain">));</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">	vec3 position = vr_Position;</code></div>
<div class="line"><code class="plain">	vec3 direction = vr_Direction;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> dot_dn = clamp(-dot(direction, normal), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> mix_value = </code><code class="value">1.0</code><code class="plain"> - pow(dot_dn, </code><code class="value">1.0</code><code class="plain"> / amount);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec4 diffuse_color = mix(front_color, background_color, mix_value);</code></div>
<div class="line"><code class="plain">	vec4 specular_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec4 diffuse = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 specular = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec4 raw_diffuse = vec4(vec3(diffuse_color) * diffuse_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 raw_specular = vec4(vec3(specular_color) * specular_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 temp = raw_diffuse + raw_specular;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> max_color_comp = max(max(temp.r,temp.g),temp.b);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain"> (max_color_comp &gt; </code><code class="value">1.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		raw_diffuse.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">		raw_specular.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vr_LightIterator light;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; vr_NumLights; ++i) {</code></div>
<div class="line"><code class="plain">		vr_evalLight(i, position, normal, light);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> cos_nl = clamp(light.dot_nl, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">if</code><code class="plain"> (cos_nl &gt; </code><code class="value">0.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">			diffuse += vec4(vec3(cos_nl) * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">float</code><code class="plain"> specular_coeff = phong_specular(light.direction, direction, normal, specular_shininess);</code></div>
<div class="line"><code class="plain">			specular += vec4(vec3(specular_coeff * cos_nl) * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	diffuse *= raw_diffuse;</code></div>
<div class="line"><code class="plain">	specular *= raw_specular;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec3 gi_contribution = vr_irradiance(normal, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	diffuse += vec4(raw_diffuse.rgb * gi_contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	gl_FragColor = diffuse + specular;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHZW5lcmF0b3JTdHJpcGU" class="heading "><span>Example: Generator Stripe</span></h4>
    <p  >    <span style="color: #333399;">
This example creates a shader with colored stripes.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/generator_strip.png" alt="images/download/attachments/2557514/generator_strip.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/generator_strip_ui.png" alt="images/download/attachments/2557514/generator_strip_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: generator_strip.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">__color uniform vec4 strip_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.5</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">__color uniform vec4 background_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.2</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> width = </code><code class="value">0.5</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> fuzz = </code><code class="value">0.5</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> scale = </code><code class="value">5.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> diffuse_scalar = </code><code class="value">0.7</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_scalar = </code><code class="value">0.06</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_shininess = </code><code class="value">10.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="keyword">float</code><code class="plain"> phong_specular(vec3 light_dir, vec3 view_dir, vec3 normal, </code><code class="keyword">float</code><code class="plain"> specular_shininess) {</code></div>
<div class="line"><code class="plain">	vec3 reflection = reflect(view_dir, normal);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cos_rl = clamp(dot(reflection, light_dir), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">return</code><code class="plain"> (pow(cos_rl, specular_shininess) * (specular_shininess + </code><code class="value">2.0</code><code class="plain">));</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">	vec3 position = vr_Position;</code></div>
<div class="line"><code class="plain">	vec3 direction = vr_Direction;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> scaled_coord_t = fract(gl_TexCoord[</code><code class="value">0</code><code class="plain">].t * scale);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> fract1 = clamp(scaled_coord_t / fuzz, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> fract2 = clamp((scaled_coord_t - width) / fuzz, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	fract1 *= (</code><code class="value">1.0</code><code class="plain"> - fract2);</code></div>
<div class="line"><code class="plain">	fract1 = smoothstep(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, fract1);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec4 diffuse_color = mix(strip_color, background_color, fract1);</code></div>
<div class="line"><code class="plain">	vec4 specular_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec4 diffuse = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 specular = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 raw_diffuse = vec4(vec3(diffuse_color) * diffuse_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 raw_specular = vec4(vec3(specular_color) * specular_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 temp = raw_diffuse + raw_specular;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> max_color_comp = max(max(temp.r,temp.g),temp.b);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain"> (max_color_comp &gt; </code><code class="value">1.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		raw_diffuse.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">		raw_specular.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vr_LightIterator light;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; vr_NumLights; ++i) {</code></div>
<div class="line"><code class="plain">		vr_evalLight(i, position, normal, light);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> cos_nl = clamp(light.dot_nl, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">if</code><code class="plain"> (cos_nl &gt; </code><code class="value">0.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">			diffuse += vec4(vec3(cos_nl) * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">float</code><code class="plain"> specular_coeff = phong_specular(light.direction, direction, normal, specular_shininess);</code></div>
<div class="line"><code class="plain">			specular += vec4(vec3(specular_coeff * cos_nl) * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	diffuse *= raw_diffuse;</code></div>
<div class="line"><code class="plain">	specular *= raw_specular;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec3 gi_contribution = vr_irradiance(normal, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	diffuse += vec4(raw_diffuse.rgb * gi_contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	gl_FragColor = diffuse + specular;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >    <span style="color: #333399;">
    </span>
    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHbG9zc3lHbGFzcw" class="heading "><span>Example: Glossy Glass</span></h4>
    <p  >    <span style="color: #333399;">
This example creates a shader like glossy glass.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/glossy_glass.png" alt="images/download/attachments/2557514/glossy_glass.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/glossy_glass_ui.png" alt="images/download/attachments/2557514/glossy_glass_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: glossy_glass.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">const</code><code class="plain"> </code><code class="keyword">int</code><code class="plain"> requiredSamples = </code><code class="value">8</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> refraction_ior = </code><code class="value">1.44</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> amount = </code><code class="value">0.1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> blend = </code><code class="value">1.0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">	vec3 direction = vr_Direction;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vr_TraceOptions options;</code></div>
<div class="line"><code class="plain">	options.rayGroup = VR_SPECULAR_DISPERSAL;</code></div>
<div class="line"><code class="plain">	options.ior = refraction_ior;</code></div>
<div class="line"><code class="plain">	options.normal = normal;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain">((vr_RayFlags &amp; VR_INDIRECT_FLAG) != </code><code class="value">0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		options.rayType = VR_TRACE_REFLECT;</code></div>
<div class="line"><code class="plain">		vec4 reflection = vr_trace(options);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		options.rayType = VR_TRACE_REFRACT;</code></div>
<div class="line"><code class="plain">		vec4 refraction = vr_trace(options);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> cos_dn = clamp(-dot(direction, normal), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> lerpFactor = (</code><code class="value">1.0</code><code class="plain"> - pow(cos_dn, </code><code class="value">1.0</code><code class="plain"> / blend));</code></div>
<div class="line"><code class="plain">		gl_FragColor = mix(refraction, reflection, lerpFactor);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec3 tangent = vr_TexTangent;</code></div>
<div class="line"><code class="plain">	vec3 binormal = vr_TexBinormal;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> numSuperSamples = vr_NumSuperSamples;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> superSampleIndex = vr_SuperSampleIndex;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sum = </code><code class="value">0.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> weights[requiredSamples];</code></div>
<div class="line"><code class="plain">	vec4 samples[requiredSamples];</code></div>
<div class="line"><code class="plain">	vec4 result = vec4(</code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="comments">// determine how much more samples will be taken for this hit point</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> nSamples = (requiredSamples &gt; numSuperSamples) ? requiredSamples : numSuperSamples; </code><code class="comments">// max</code></div>
<div class="line"><code class="plain">	nSamples /= numSuperSamples;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> startSampleIndex = superSampleIndex * nSamples;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	options.rayGroup = VR_GLOSSY_DISPERSAL;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; nSamples; ++i) {</code></div>
<div class="line"><code class="plain">		vec3 randomSample = vr_randomSample(startSampleIndex + i, nSamples);</code></div>
<div class="line"><code class="plain">		vec2 offset = randomSample.xy - </code><code class="value">0.5</code><code class="plain">;</code></div>
<div class="line"><code class="plain">		offset *= (</code><code class="value">2.0</code><code class="plain"> * amount);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		vec3 bumpedNormal = normal + offset.x * tangent + offset.y * binormal;</code></div>
<div class="line"><code class="plain">		options.normal = bumpedNormal;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">		options.rayType = VR_TRACE_REFLECT;</code></div>
<div class="line"><code class="plain">		vec4 reflection = vr_trace(options);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		options.rayType = VR_TRACE_REFRACT;</code></div>
<div class="line"><code class="plain">		vec4 refraction = vr_trace(options);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> cos_dn = clamp(-dot(direction, bumpedNormal), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> lerpFactor = (</code><code class="value">1.0</code><code class="plain"> - pow(cos_dn, </code><code class="value">1.0</code><code class="plain"> / blend));</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		samples[i] = mix(refraction, reflection, lerpFactor);</code></div>
<div class="line"><code class="plain">		weights[i] = dot(normal, bumpedNormal);</code></div>
<div class="line"><code class="plain">		sum += weights[i];</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> inverseSum = </code><code class="value">1.0</code><code class="plain"> / sum;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; nSamples; ++i) {</code></div>
<div class="line"><code class="plain">		weights[i] *= inverseSum;</code></div>
<div class="line"><code class="plain">		result += weights[i] * samples[i];</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	gl_FragColor = result;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHbG9zc3lQaG9uZw" class="heading "><span>Example: Glossy Phong</span></h4>
    <p  >    <span style="color: #333399;">
This shader implements a modified Phong model with normal perturbation.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/glossy_phong.png" alt="images/download/attachments/2557514/glossy_phong.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/glossy_phong_ui.png" alt="images/download/attachments/2557514/glossy_phong_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >File: glossy_phong.frag    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> amount = </code><code class="value">0.1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> diffuse_scalar = </code><code class="value">0.7</code><code class="plain">;</code></div>
<div class="line"><code class="plain">__color uniform vec4 diffuse_color = vec4(</code><code class="value">0.9</code><code class="plain">, </code><code class="value">0.2</code><code class="plain">, </code><code class="value">0.8</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_scalar = </code><code class="value">0.06</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_shininess = </code><code class="value">20.0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">const</code><code class="plain"> </code><code class="keyword">int</code><code class="plain"> requiredSamples = </code><code class="value">16</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">float</code><code class="plain"> phong_specular(vec3 light_dir, vec3 direction, vec3 normal) {</code></div>
<div class="line"><code class="plain">	vec3 reflection = reflect(direction, normal);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cos_rl = clamp(dot(reflection, light_dir), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">return</code><code class="plain"> (pow(cos_rl, specular_shininess) * (specular_shininess + </code><code class="value">2.0</code><code class="plain">));</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	bool isGIRay = ((vr_RayFlags &amp; VR_INDIRECT_FLAG) != </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">	vec3 direction = vr_Direction;</code></div>
<div class="line"><code class="plain">	vec3 position = vr_Position;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 raw_diffuse = vec4(vec3(diffuse_color) * diffuse_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 raw_specular = vec4(vec3(specular_scalar), </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 temp = raw_diffuse + raw_specular;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> max_color_comp = max(max(temp.r,temp.g),temp.b);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain"> (max_color_comp &gt; </code><code class="value">1.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		raw_diffuse.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">		raw_specular.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 diffuse_contrib = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 specular_contrib = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="comments">// if this is a GI ray do not try to estimate glossy highlights accurately</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain">(isGIRay) {</code></div>
<div class="line"><code class="plain">		vr_LightIterator light;</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> j = </code><code class="value">0</code><code class="plain">; j &lt; vr_NumLights; ++j) {</code></div>
<div class="line"><code class="plain">			vr_evalLight(j, position, normal, light);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">			</code><code class="keyword">float</code><code class="plain"> cos_nl = clamp(light.dot_nl, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">if</code><code class="plain"> (cos_nl &gt; </code><code class="value">0.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">				diffuse_contrib += vec4(cos_nl * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">				</code><code class="keyword">float</code><code class="plain"> specular_coeff = phong_specular(light.direction, direction, normal);</code></div>
<div class="line"><code class="plain">				specular_contrib += vec4(specular_coeff * cos_nl * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">			}</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">		vec3 tangent = vr_TexTangent;</code></div>
<div class="line"><code class="plain">		vec3 binormal = vr_TexBinormal;</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">int</code><code class="plain"> numSuperSamples = vr_NumSuperSamples;</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">int</code><code class="plain"> superSampleIndex = vr_SuperSampleIndex;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> sum = </code><code class="value">0.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> weights[requiredSamples];</code></div>
<div class="line"><code class="plain">		vec4 specular_samples[requiredSamples];</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="comments">// determine how much more samples will be taken for this hit point</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">int</code><code class="plain"> nSamples = (requiredSamples &gt; numSuperSamples) ? requiredSamples : numSuperSamples; </code><code class="comments">// max</code></div>
<div class="line"><code class="plain">		nSamples /= numSuperSamples;</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">int</code><code class="plain"> startSampleIndex = superSampleIndex * nSamples;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; nSamples; ++i) {</code></div>
<div class="line"><code class="plain">			vec3 randomSample = vr_randomSample(startSampleIndex + i, nSamples);</code></div>
<div class="line"><code class="plain">			vec2 offset = (randomSample.xy - </code><code class="value">0.5</code><code class="plain">) * </code><code class="value">2.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">			offset *= amount;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">			vec3 bumpedNormal = normalize(normal + offset.x * tangent + offset.y * binormal);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">			vr_LightIterator light;</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> j = </code><code class="value">0</code><code class="plain">; j &lt; vr_NumLights; ++j) {</code></div>
<div class="line"><code class="plain">				vr_evalLight(j, position, bumpedNormal, light);</code></div>
<div class="line"><code class="plain">				</code><code class="keyword">float</code><code class="plain"> cos_nl = clamp(light.dot_nl, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">				</code><code class="keyword">if</code><code class="plain">(cos_nl &gt; </code><code class="value">0.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">					diffuse_contrib += vec4(cos_nl * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">					</code><code class="keyword">float</code><code class="plain"> specular_coeff = phong_specular(light.direction, direction, bumpedNormal);</code></div>
<div class="line"><code class="plain">					specular_samples[i] += vec4(specular_coeff * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">				}</code></div>
<div class="line"><code class="plain">			}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">			weights[i] = dot(normal, bumpedNormal);</code></div>
<div class="line"><code class="plain">			sum += weights[i];</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> inverseSum = </code><code class="value">1.0</code><code class="plain"> / sum;</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; nSamples; ++i) {</code></div>
<div class="line"><code class="plain">			weights[i] *= inverseSum;</code></div>
<div class="line"><code class="plain">			specular_contrib += weights[i] * specular_samples[i];</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">		diffuse_contrib /= </code><code class="keyword">float</code><code class="plain">(nSamples);</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	diffuse_contrib += vec4(vr_irradiance(normal, </code><code class="value">1.0</code><code class="plain">), </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	diffuse_contrib *= raw_diffuse;</code></div>
<div class="line"><code class="plain">	specular_contrib *= raw_specular;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	gl_FragColor = diffuse_contrib + specular_contrib;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >    <span style="color: #333399;">
    </span>
    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpHbG9zc3lSZWZsZWN0aW9u" class="heading "><span>Example: Glossy Reflection</span></h4>
    <p  >    <span style="color: #333399;">
This shader implements glossy reflection based on the Phong model.    </span>
    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/glossy_reflection.png" alt="images/download/attachments/2557514/glossy_reflection.png"   />
        </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/glossy_reflection_ui.png" alt="images/download/attachments/2557514/glossy_reflection_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: glossy_reflection.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> amount = </code><code class="value">0.1</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">const</code><code class="plain"> </code><code class="keyword">int</code><code class="plain"> requiredSamples = </code><code class="value">16</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vr_TraceOptions options;</code></div>
<div class="line"><code class="plain">	options.rayType = VR_TRACE_REFLECT;</code></div>
<div class="line"><code class="plain">	options.rayGroup = VR_SPECULAR_DISPERSAL;</code></div>
<div class="line"><code class="plain">	options.normal = normal;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain">((vr_RayFlags &amp; VR_INDIRECT_FLAG) != </code><code class="value">0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		gl_FragColor = vr_trace(options);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec3 tangent = vr_TexTangent;</code></div>
<div class="line"><code class="plain">	vec3 binormal = vr_TexBinormal;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> numSuperSamples = vr_NumSuperSamples;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> superSampleIndex = vr_SuperSampleIndex;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sum = </code><code class="value">0.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> weights[requiredSamples];</code></div>
<div class="line"><code class="plain">	vec4 samples[requiredSamples];</code></div>
<div class="line"><code class="plain">	vec4 result = vec4(</code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="comments">// determine how much more samples will be taken for this hit point</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> nSamples = (requiredSamples &gt; numSuperSamples) ? requiredSamples : numSuperSamples; </code><code class="comments">// max</code></div>
<div class="line"><code class="plain">	nSamples /= numSuperSamples;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">int</code><code class="plain"> startSampleIndex = superSampleIndex * nSamples;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	options.rayGroup = VR_GLOSSY_DISPERSAL;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; nSamples; ++i) {</code></div>
<div class="line"><code class="plain">		vec3 randomSample = vr_randomSample(startSampleIndex + i, nSamples);</code></div>
<div class="line"><code class="plain">		vec2 offset = (randomSample.xy - </code><code class="value">0.5</code><code class="plain">) * </code><code class="value">2.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">		offset *= amount;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		vec3 bumpedNormal = normalize(normal + offset.x * tangent + offset.y * binormal);</code></div>
<div class="line"><code class="plain">		options.normal = bumpedNormal;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		samples[i] = vr_trace(options);</code></div>
<div class="line"><code class="plain">		weights[i] = dot(normal, bumpedNormal);</code></div>
<div class="line"><code class="plain">		sum += weights[i];</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> inverseSum = </code><code class="value">1.0</code><code class="plain"> / sum;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; nSamples; ++i) {</code></div>
<div class="line"><code class="plain">		weights[i] *= inverseSum;</code></div>
<div class="line"><code class="plain">		result += weights[i] * samples[i];</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	gl_FragColor = result;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >    <span style="color: #333399;">
    </span>
    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpPcmVuLU5heWFy" class="heading "><span>Example: Oren-Nayar</span></h4>
    <p  >    <span style="color: #333399;">
This shader implements the Oren-Nayar model for direct illumination.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/oren_nayar.png" alt="images/download/attachments/2557514/oren_nayar.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/oren_nayar_ui.png" alt="images/download/attachments/2557514/oren_nayar_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: oren_nayar.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">__color uniform vec4 diffuse_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> diffuse_scalar = </code><code class="value">0.7</code><code class="plain">;</code></div>
<div class="line"><code class="plain">__color uniform vec4 specular_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain"> ,</code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_scalar = </code><code class="value">0.06</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> diffuse_deviation = </code><code class="value">0.5</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_shininess = </code><code class="value">10.0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">float</code><code class="plain"> orennayar_diffuse(vec3 light_dir, vec3 view_dir, vec3 normal) {</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sigma_sqred = diffuse_deviation * diffuse_deviation;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> A = </code><code class="value">1.0</code><code class="plain"> - (sigma_sqred / (</code><code class="value">2.0</code><code class="plain"> * (sigma_sqred + </code><code class="value">0.33</code><code class="plain">)));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> B = (</code><code class="value">0.45</code><code class="plain"> * sigma_sqred) / (sigma_sqred + </code><code class="value">0.09</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cosThetaI = dot(light_dir, normal);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cosThetaO = -dot(view_dir, normal);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sinThetaI = sqrt(max(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain"> - (cosThetaI * cosThetaI)));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sinThetaO = sqrt(max(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain"> - (cosThetaO * cosThetaO)));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cosPhiI = dot(light_dir, vr_TexTangent);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cosPhiO = -dot(view_dir, vr_TexTangent);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sinPhiI = sqrt(max(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain"> - (cosPhiI * cosPhiI)));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sinPhiO = sqrt(max(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain"> - (cosPhiO * cosPhiO)));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> temp = max(</code><code class="value">0.0</code><code class="plain">, (cosPhiI * cosPhiO) + (sinPhiI * sinPhiO));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> sinAlpha;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> tanBeta;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain"> (cosThetaI &gt; cosThetaO) {</code></div>
<div class="line"><code class="plain">		sinAlpha = sinThetaO;</code></div>
<div class="line"><code class="plain">		tanBeta = (sinThetaI / cosThetaI);</code></div>
<div class="line"><code class="plain">	} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">		sinAlpha = sinThetaI;</code></div>
<div class="line"><code class="plain">		tanBeta = (sinThetaO / cosThetaO);</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> result = (A + (B * temp * sinAlpha * tanBeta));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">return</code><code class="plain"> clamp(result, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="keyword">float</code><code class="plain"> phong_specular(vec3 light_dir, vec3 view_dir, vec3 normal) {</code></div>
<div class="line"><code class="plain">	vec3 reflection = reflect(view_dir, normal);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cos_rl = clamp(dot(reflection, light_dir), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">return</code><code class="plain"> (pow(cos_rl, specular_shininess) * (specular_shininess + </code><code class="value">2.0</code><code class="plain">));</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">	vec4 diffuse = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 specular = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 diffuse_contrib = vec4(vec3(diffuse_color) * diffuse_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 specular_contrib = vec4(vec3(specular_color) * specular_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 temp = diffuse_contrib + specular_contrib;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> max_color_component = max(max(temp.r,temp.g),temp.b);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain"> (max_color_component &gt; </code><code class="value">1.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		diffuse_contrib.rgb /= max_color_component;</code></div>
<div class="line"><code class="plain">		specular_contrib.rgb /= max_color_component;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec3 view_dir = vr_Direction;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vr_LightIterator lightIter;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; vr_NumLights; ++i) {</code></div>
<div class="line"><code class="plain">		vr_evalLight(i, vr_Position, normal, lightIter);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> cos_nl = clamp(lightIter.dot_nl, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">if</code><code class="plain"> (cos_nl &gt; </code><code class="value">0.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">float</code><code class="plain"> diffuse_term = orennayar_diffuse(lightIter.direction, view_dir, normal);</code></div>
<div class="line"><code class="plain">			diffuse += vec4(vec3(diffuse_term * cos_nl) * lightIter.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">float</code><code class="plain"> specular_term = phong_specular(lightIter.direction, view_dir, normal);</code></div>
<div class="line"><code class="plain">			specular += vec4(vec3(specular_term * cos_nl) * lightIter.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	diffuse *= diffuse_contrib;</code></div>
<div class="line"><code class="plain">	specular *= specular_contrib;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec3 gi_contrib = vr_irradiance(normal, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	diffuse += vec4(vec3(diffuse_contrib) * gi_contrib, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	gl_FragColor = diffuse + specular;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >    <span style="color: #333399;">
    </span>
    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpUdXJidWxlbmNl" class="heading "><span>Example: Turbulence</span></h4>
    <p  >    <span style="color: #333399;">
This shader changes its color based on a fractal texture.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/turbulence.png" alt="images/download/attachments/2557514/turbulence.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/turbulence_ui.png" alt="images/download/attachments/2557514/turbulence_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: turbulence.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> noise_scale = </code><code class="value">2.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> noise_gain = </code><code class="value">0.8</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> noise_lacunarity = </code><code class="value">3.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">__color uniform vec4 color1 = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">__color uniform vec4 color2 = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> diffuse_scalar = </code><code class="value">0.8</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_scalar = </code><code class="value">0.02</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> specular_shininess = </code><code class="value">10.0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">const</code><code class="plain"> </code><code class="keyword">int</code><code class="plain"> octaves_count = </code><code class="value">4</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">float</code><code class="plain"> phong_specular(vec3 light_dir, vec3 view_dir, vec3 normal, </code><code class="keyword">float</code><code class="plain"> specular_shininess) {</code></div>
<div class="line"><code class="plain">	vec3 reflection = reflect(view_dir, normal);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> cos_rl = clamp(dot(reflection, light_dir), </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">return</code><code class="plain"> (pow(cos_rl, specular_shininess) * (specular_shininess + </code><code class="value">2.0</code><code class="plain">));</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">	vec3 position = vr_Position;</code></div>
<div class="line"><code class="plain">	vec3 direction = vr_Direction;</code></div>
<div class="line"><code class="plain">	vec3 noise_position = vec3(gl_TexCoord[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec3 scaled_position = noise_position * vec3(noise_scale);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> noise_amplitude = </code><code class="value">2.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> noise_frequency = </code><code class="value">0.5</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	vec3 noise_value = vec3(</code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain">((vr_RayFlags &amp; VR_INDIRECT_FLAG) != </code><code class="value">0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		noise_value = vec3(</code><code class="value">0.5</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; octaves_count; ++i) {</code></div>
<div class="line"><code class="plain">			noise_value += abs(noise3(scaled_position * vec3(noise_frequency))) * vec3(noise_amplitude);</code></div>
<div class="line"><code class="plain">			noise_frequency *= noise_lacunarity;</code></div>
<div class="line"><code class="plain">			noise_amplitude *= noise_gain;</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 diffuse_color = mix(color1, color2, vec4(noise_value, </code><code class="value">1.0</code><code class="plain">));</code></div>
<div class="line"><code class="plain">	vec4 specular_color = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 diffuse = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 specular = vec4(</code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 raw_diffuse = vec4(vec3(diffuse_color) * diffuse_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	vec4 raw_specular = vec4(vec3(specular_color) * specular_scalar, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec4 temp = raw_diffuse + raw_specular;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> max_color_comp = max(max(temp.r,temp.g),temp.b);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain"> (max_color_comp &gt; </code><code class="value">1.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">		raw_diffuse.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">		raw_specular.rgb /= max_color_comp;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vr_LightIterator light;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; vr_NumLights; ++i) {</code></div>
<div class="line"><code class="plain">		vr_evalLight(i, position, normal, light);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">float</code><code class="plain"> cos_nl = clamp(light.dot_nl, </code><code class="value">0.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">if</code><code class="plain"> (cos_nl &gt; </code><code class="value">0.0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">			diffuse += vec4(vec3(cos_nl) * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">float</code><code class="plain"> specular_coeff = phong_specular(light.direction, direction, normal, specular_shininess);</code></div>
<div class="line"><code class="plain">			specular += vec4(vec3(specular_coeff * cos_nl) * light.contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	diffuse *= raw_diffuse;</code></div>
<div class="line"><code class="plain">	specular *= raw_specular;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	vec3 gi_contribution = vr_irradiance(normal, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code></div>
<div class="line"><code class="plain">	diffuse += vec4(raw_diffuse.rgb * gi_contribution, </code><code class="value">0.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	gl_FragColor = diffuse + specular;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >    <span style="color: #333399;">
    </span>
    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpCbGlubk1hdGVyaWFs" class="heading "><span>Example: Blinn Material</span></h4>
    <p  >    <span style="color: #333399;">
Material based on the Blinn BRDF model.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/blinn_material.png" alt="images/download/attachments/2557514/blinn_material.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/blinn_material_ui.png" alt="images/download/attachments/2557514/blinn_material_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: blinn_material.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">uniform sampler2D diffuseTex;</code></div>
<div class="line"><code class="plain">__color uniform vec4 specular = vec4(</code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform </code><code class="keyword">float</code><code class="plain"> highlightGlossiness = </code><code class="value">0.8</code><code class="plain">;</code></div>
<div class="line"><code class="plain">uniform sampler2D anisotropyTex;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"><code class="plain">	vec2 uv_coords = vec2(gl_TexCoord[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vr_DiffuseBRDFSettings diffuseSettings;</code></div>
<div class="line"><code class="plain">	diffuseSettings.color = vec3(texture2D(diffuseTex, uv_coords));</code></div>
<div class="line"><code class="plain">	diffuseSettings.normal = normal;</code></div>
<div class="line"><code class="plain">	vr_brdf_diffuse(diffuseSettings);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vr_GlossyBRDFSettings blinnSettings;</code></div>
<div class="line"><code class="plain">	blinnSettings.color = vec3(specular);</code></div>
<div class="line"><code class="plain">	blinnSettings.normal = normal;</code></div>
<div class="line"><code class="plain">	blinnSettings.highlightGlossiness = highlightGlossiness;</code></div>
<div class="line"><code class="plain">	blinnSettings.anisotropy = </code><code class="value">2.0</code><code class="plain"> * texture2D(anisotropyTex, uv_coords).x - </code><code class="value">1.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	blinnSettings.traceReflections = </code><code class="keyword">false</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	vr_brdf_blinn(blinnSettings);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	gl_FragColor = vec4(vec3(</code><code class="value">0.0</code><code class="plain">), </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >    <span style="color: #333399;">
    </span>
    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpUcmFuc3BhcmVudE1hdGVyaWFs" class="heading "><span>Example: Transparent Material</span></h4>
    <p  >    <span style="color: #333399;">
Transparent material using the alpha output.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/transparent_material.png" alt="images/download/attachments/2557514/transparent_material.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/transparent_material_ui.png" alt="images/download/attachments/2557514/transparent_material_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: transparent_material.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">__color uniform vec4 diffuse = vec4(</code><code class="value">0.6</code><code class="plain">, </code><code class="value">0.2</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">uniform sampler2D transparency;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vr_DiffuseBRDFSettings diffuseSettings;</code></div>
<div class="line"><code class="plain">	diffuseSettings.color = vec3(diffuse);</code></div>
<div class="line"><code class="plain">	diffuseSettings.normal = normal;</code></div>
<div class="line"><code class="plain">	vr_brdf_diffuse(diffuseSettings);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vec3 textureSample = vec3(texture2D(transparency, vec2(gl_TexCoord[</code><code class="value">0</code><code class="plain">])));</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">float</code><code class="plain"> alpha = dot(textureSample, vec3(</code><code class="value">0.3333333</code><code class="plain">));</code></div>
<div class="line"><code class="plain">	gl_FragColor = vec4(vec3(</code><code class="value">0.0</code><code class="plain">), alpha);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <h4 id="src-2557514_safe-id-R0xTTFN1cHBvcnQtRXhhbXBsZTpSZW5kZXJDaGFubmVscw" class="heading "><span>Example: Render Channels</span></h4>
    <p  >    <span style="color: #333399;">
Shader attaching and writing to render channels in the V-Ray VFB.    </span>
    </p>
    <p  >    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/render_channel.png" alt="images/download/attachments/2557514/render_channel.png"   />
<br/>    </span>
    </p>
    <p  >    <span style="color: #333399;">
Rendered shader    </span>
    </p>
    <p  ><strong class=" ">    <span style="color: #333399;">
    <img  class="confluence-embedded-image" src="images/download/attachments/2557514/render_channel_ui.png" alt="images/download/attachments/2557514/render_channel_ui.png"   />
<br/>    </span>
</strong>    </p>
    <p  >    <span style="color: #333399;">
Shader parameters    </span>
    </p>
    <p  >    <span style="color: #333399;">
Shader source code:    </span>
    </p>
    <p  >    <span style="color: #333333;">
File: render_channel.frag    </span>
    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">#version </code><code class="value">110</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">__color uniform vec4 diffuse = vec4(</code><code class="value">0.3</code><code class="plain">, </code><code class="value">0.8</code><code class="plain">, </code><code class="value">0.2</code><code class="plain">, </code><code class="value">1.0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">__channel vec3 NormalSpace = vec3(</code><code class="value">0.314</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> main() {</code></div>
<div class="line"><code class="plain">	vec3 normal = (gl_FrontFacing) ? vr_Normal : -vr_Normal;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	NormalSpace = normal;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	vr_DiffuseBRDFSettings diffuseSettings;</code></div>
<div class="line"><code class="plain">	diffuseSettings.color = vec3(diffuse);</code></div>
<div class="line"><code class="plain">	diffuseSettings.normal = normal;</code></div>
<div class="line"><code class="plain">	vr_brdf_diffuse(diffuseSettings);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	gl_FragColor.a = </code><code class="value">1.0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
        </div>
    </div>
    </div>
    <div class="section section-1" id="src-2557514_GLSLSupport-Notes">
        <h1 class="heading "><span>Notes </span></h1>
<ul class=" "><li class=" ">    <p  >    <span style="color: #000000;">
<strong class=" ">OpenGL Shading Language</strong> specification officially supported is <strong class=" ">1.10.59</strong>    </span>
    </p>
</li></ul>    <p  >    </p>
    <p  >    </p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Distributed_Rendering.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Distributed Rendering</span>
        </a>
                <a href="OSL_Support.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>OSL Support</span>
        </a>
    </nav>    
            
            <article id="html-search-results" class="ht-content" style="display: none;">
            <header class="ht-content-header">
                <div id="ht-spacetitle">
                    <ul>
                        <li><a href="V-Ray_2.0_for_3ds_Max.html">V-Ray 2.0 for 3ds Max</a></li>
                    </ul>
                </div>
                <h1>Search results</h1>
            </header>
            <div id="search-results"></div>
        </article>
    
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
